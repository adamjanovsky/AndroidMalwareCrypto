# Experiment config and output

This folder contains two major components of an experiment, namely the `records.json` and `config.yml`. 

## Records.json 

The contents of the `records.json` file is a list of analyzed APK, where each of the APKs uses its sha256 fingerprint as a key, and the value is the following dictionary:

```
{
"sha256_fingerprint": {
	"metadata": {
		"apk_path": Path to the apk file, for internat representation,
		"dx_path": Path to the apk file, for internat representation, 
		"dex_year": null if own APKs supplied, year of APK from dex_date if Androzoo supplied, 
		"euphony_name": Euphony label,
		 "euphony_type": Euphony type
	}, 
	"third_party_crypto_libs": [], # List of detected third-party cryptographic javalibraries, e.g., `org/keyczar`
	"third_party_packages": [], # List of all packages that were detected as a third-party by LiteRadar
	"crypto_imports": {"java.security.messagedigest": 8}, # dictionary of class_name: class_count. Shows how many times were specific classes from JCA imported in the APK
	 "crypto_api_records": { # This is where the main collection resides. Dict of class_name: list, where example of such list is below
	 	"Lcom/mpaopao/client/tools/utils/MD5Generate;": [
	 		["MessageDigest.getInstance(", "            MessageDigest md = MessageDigest.getInstance(\"MD5\");", 9] # Each element in a list is a tripled: (trigger, whole line, line_number)
	 	]
	}
	"native_imports": [] # List of detected third-party native cryptographic libraries
}
```

## Config.yml

The main configuration file in the form of an yml file. It contains general options (highest level) and task- specific options. We comment on each key here:

### General options

- `tasks`: List; specifies which tasks to perform. Must be in the correct order. Any ordered subset will do. Options: `download, decompile, third_party_libs, evaluate, label`
- `is_being_logged`: Bool; Whether Neptune.ai should log the experiment or not. If you don't have Neptune.ai integrated, leave it `False`
- `n_threads`: Int; Specifies how many threads to use for computation
- `neptune_project_name`: String; `TeamName/ProjectName` of your profile on a Neptune.ai service.
- `experiment_name`: String; Is used to give the experiment specific name. Leave an empty string if you don't wish to use it.
- `dataset_path`: String; Path to your dataset, see [dataset](../dataset/readme.md) for more instructions
- `timeout`: Int; How many seconds to run before terminate the analysis of a single APK. Decompilation does may not halt for some samples. 900 is default.
- `delete_corrupted`: Bool, whether improperly processed samples should get deleted from the dataset or not. *This may delete your APKS!*


### Download task

- `csv_path`: String; Path to the androzoo list of CSVs, see [Androzoo integration](https://github.com/adamjanovsky/AndroidMalwareCrypto/blob/master/README.md#androzoo-integration) for more details.
- `n_samples`:  Int; How many samples should be downloaded from the Androzoo
- `start_year`: Int; see end_year
- `end_year`: Int; the pair `(start_year,end_year)` specifies the interval from which the samples will get downloaded. E.g., 2012-2014 will download samples only from this timespan.
- `max_size`: Int; Maximal size of the apk in bytes, 20MB is default
- `strategy`: Categorical;  Keep uniform here. It tells you how to sample the apks from the years. In this case, you get 11 samples evenly distributed from the years 2013-2019. 'uniform' is default.
- `minimal_vt_positives`: Int; How many Virus total positive scores should the downloaded APKs have. 5 is default.
- `delete_apks`: Bool; If we should delete the APK after the experiment or not. True is default.

### Decompile task

- `delete_dxs`: Bool; Whether the pickled Androguard analysis object should be deleted or not. We suggest to delete them, they are quite space consuming.
- `jadx_path`: String; Path to the jadx binary. Feel free to keep it `jadx` if jadx is in your system path


### Third-party libs task

- `literadar_path`: String; Path to literadar script, if the [LiteRadar integration](https://github.com/adamjanovsky/AndroidMalwareCrypto#literadar-integration) is functional.
- `crypto_libs`: List; list of strings, where each strings represents a third-party package to search for with LiteRadar, e.g., `Lorg/whispersystems/curve25519`

### Evaluate task

- `imports`: List of strings; List of JCA classes that the imports will be counted for. 
- `native_imports`: List of strings; Similar to `third_party_libs/crypto_libs`, specifies which native cryptographic libraries to search for. For instance, `PolarSSL`.
- `categories`:  The most important configuration. Here, you can specify the triggers that you will search for in your sample. See the actual config for a self-expanatory example.

### Label task

- `euphony_names_path`: "/path/to/euphony/names_proposed.json" 
- `euphony_types_path`: "/path/to/euphony/types_proposed.json"