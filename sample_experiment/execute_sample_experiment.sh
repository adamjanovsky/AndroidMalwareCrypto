MALICIOUS_URL="https://data.mendeley.com/api/datasets/hmsnkrhm9g/draft/files/4212840b-d989-401d-b3ce-14c5fc079ce4?a=8b536bfa-dd38-4e3e-8172-a464516fa46d"
BENIGN_URL="https://data.mendeley.com/api/datasets/hmsnkrhm9g/draft/files/4b6341d8-e2c1-40b9-a8bc-ab37bdfd12bf?a=8b536bfa-dd38-4e3e-8172-a464516fa46d"

# get directory of script and its parent (root)
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
ROOT_DIR=$(dirname ${SCRIPT_DIR})
PREV_DIR=$(pwd)

echo "Entering directory ${SCRIPT_DIR} of script."
cd $SCRIPT_DIR

# install requiremenets
echo "Installing requirements."
python3 -m pip install --user -r ${ROOT_DIR}/requiremenets.txt

echo "Downloading data."
# download data
curl -L $MALICIOUS_URL --output data/malicious_dataset.zip
unzip data/malicious_dataset.zip -d data
curl -L $BENIGN_URL --output data/benign_dataset.zip
unzip data/benign_dataset.zip -d data

echo "Processing benign samples."
# cli_process.py
python3 ${ROOT_DIR}/cli_process.py configs/dataset_processing/benign_processing.yml
echo "Processing malicious samples."
python3 ${ROOT_DIR}/cli_process.py configs/dataset_processing/malicious_processing.yml

echo "Preparing data."
# cli_prepare.py
python3 ${ROOT_DIR}/cli_prepare.py configs/preparation/full_with_feature_engineering_output.yml

echo "Exploring data."
# cli_automatically_explore.py
python3 ${ROOT_DIR}/cli_automatically_explore.py data/features.csv data/eda_report.html

echo "Training Random Forest."
# cli_train.py
python3 ${ROOT_DIR}/cli_train.py configs/training/train_model.yml

echo "Explaining Random Forest."
# cli_explain.py
python3 ${ROOT_DIR}/cli_explain.py configs/explainability/explain_config.yml

# TODO maybe add evaluation/explanation notebooks to execute?

echo "Returning to previous directory."
cd $PREV_DIR
