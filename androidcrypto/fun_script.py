import androidcrypto.helpers as helpers
from androidcrypto.dataset import Dataset
from importlib import reload


import os
import pickle
import pyjadx


def main():
    dset = Dataset('/Users/adam/phd/projects/CryptoMalware/datasets/baby_dataset')
    output_path = '/Users/adam/Downloads/'
    jadx = pyjadx.Jadx()

    for apk in dset.apks:
        try:
            decompiled = jadx.load(apk)
            basename = os.path.basename(apk)
            new_name = basename.split('.')[0] + '.java'

            with open(os.path.join(output_path, new_name), 'wb') as f:
                pickle.dump(decompiled, f)

        except Exception as e:
            print(f'Caught exception: {e}')
            #reload(pyjadx)
            #new_jadx = pyjadx.Jadx()
            #jadx = new_jadx


if __name__ == '__main__':
    main()





