import requests
from androidcrypto.constants import DownloadException
from stopit import TimeoutException
import logging

logging.getLogger('urllib3').setLevel(logging.CRITICAL)


def download_worker(sample, task_config):
    try:
        response = requests.get(sample.androzoo_url)
        if response.status_code != 200:
            raise DownloadException(f'Failed with status code: {response.status_code}')

        with open(sample.apk_path, 'wb') as handle:
            handle.write(response.content)

    except Exception as e:
        if isinstance(e, TimeoutException):
            raise
        else:
            raise DownloadException

