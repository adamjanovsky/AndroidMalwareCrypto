import requests
from androidcrypto.constants import DownloadException
from stopit import TimeoutException


def download_worker(sample, task_config):
    try:
        response = requests.get(sample.androzoo_url)
        code = response.status_code
        if code != 200:
            raise DownloadException

        with open(sample.apk_path, 'wb') as handle:
            handle.write(response.content)

    except Exception as e:
        if isinstance(e, TimeoutException):
            raise
        else:
            raise DownloadException

