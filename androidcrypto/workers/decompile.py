from androguard.core.bytecodes.apk import APK
from androguard.core.bytecodes.dvm import DalvikVMFormat
from androguard.core.analysis.analysis import Analysis
from androguard.decompiler.decompiler import DecompilerJADX
import lzma
import pickle


def decompile_worker(apk_path, dx_path):
    try:
        a = APK(apk_path)
        d = DalvikVMFormat(a)
        dx = Analysis(d)
        d.set_decompiler(DecompilerJADX(d, dx, jadx='jadx'))  # TODO: Add custom path
        dx.create_xref()
        if len(dx.classes) > 0:
            with lzma.open(dx_path, 'wb') as handle:
                pickle.dump(dx, handle)
    except Exception:
        return False

    return False


