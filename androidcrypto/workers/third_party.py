import androidcrypto.constants as constants
import subprocess
import os
import json


def third_party_worker(sample_record):
    tmp_filepath = sample_record['metadata']['third_party_tmp_path']
    string_to_call = 'python2 ' + constants.LITERADAR_PATH + ' ' +sample_record['metadata']['apk_path'] + ' ' + tmp_filepath
    third_party_packages = []
    try:
        os.system(string_to_call)
        with open(tmp_filepath, 'r') as handle:
            data = json.load(handle)

        for lib in data:
            third_party_packages.append(lib['Package'])

        os.remove(tmp_filepath)
    except:
        return False

    sample_record['third_party_libs'] = third_party_packages

    return True
