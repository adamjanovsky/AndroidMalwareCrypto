# AndroidMalwareCrypto

This tool allows for an analysis of cryptographic API in Android applications. The tool was developed specifically to compare cryptographic API usage in benign vs. malicious applications and contains (weak) malware classifier based purely on cryptographic API features. We strive to provide an end-to-end solution, delivering all steps in the analysis:
1. Decompilation of the APKs,
2. collection of cryptographic API usage in the decompiled binaries by regex matching,
3. exploratory data analysis of crypto API in your dataset,
4. training and evaluation of malware classifier based on crypto API features,
5. explanations of the classifier using [SHAP](https://github.com/slundberg/shap).

We provide a Docker image to foster experiment reproducibility. Additionally, we describe our controlled environment and give guidance for anyone who wishes to fully replicate our research in our [docs](https://androidmalwarecrypto.readthedocs.io).

[![GitHub Workflow Status](https://img.shields.io/github/workflow/status/adamjanovsky/AndroidMalwareCrypto/Docker%20Image%20CI?label=Docker%20build&style=flat-square)](https://hub.docker.com/repository/docker/adamjanovsky/cryptomlw)
[![Documentation Status](https://img.shields.io/readthedocs/androidmalwarecrypto?style=flat-square)](https://androidmalwarecrypto.readthedocs.io/en/latest/?badge=latest)

## Paper

This repository accompanies the following paper

*A Longitudinal Study of Cryptographic API: a Decade of Android Malware*. <br/>
Conference: SECRYPT 2022<br/>
Paper pdf: [arXiv:2205.05573](https://arxiv.org/abs/2205.05573) <br/>

You can cite this research as follows.

```bibtex
@InProceedings{2022-secrypt-janovsky,
  Title         = {{A Longitudinal Study of Cryptographic API: A Decade of Android Malware}},
  Author        = {Adam Janovsky and Davide Maiorca and Dominik Macko and Vashek Matyas and Giorgio Giacinto},
  BookTitle     = {Proceedings of the 19th International Conference on Security and Cryptography},
  Pages         = {121--133},
  Year          = {2022},
  ISBN          = {978-989-758-590-6},
  ISSN          = {2184-7711},
  URL           = {https://github.com/adamjanovsky/AndroidMalwareCrypto},
  Keywords      = {cryptolibs, malware, Android},
}
```

## Installation

The project is written and tested on Python 3.8. Apart from bare Python, the tool requires integration with some patched repositories. Due to complex installation process, we offer a Docker image of our tool that can be run interactively. In addition, the [Dockerfile](docker/Dockerfile) contains consise instructions on how to install our tool on vanilla Ubuntu.

## Quickstart

You can run a complete analysis on a toy dataset (10 APKs) in Docker using the following commands.

1. Install [Docker](https://docs.docker.com/get-docker/) if you havenâ€™t already,
2. pull the image with `docker pull adamjanovsky/cryptomlw:latest`,
3. run the image interactively with `docker run -it adamjanovsky/cryptomlw`,
4. now you can run the experiment with
```
cd AndroidMalwareCrypto \
&& python3 ./cli_process.py sample_experiment/configs/dataset_processing/config_processing.yml
```
5. you can then view the output of the experiment in `/home/user/AndroidMalwareCrypto/sample_experiment/dataset/`.

It is recommended that you set up a [Docker volume](https://docs.docker.com/storage/volumes/) outside of the container and use it in combination with the image to produce results stored on your local folder outside of the docker container.

## Analyze your own large dataset

Analyzing a large dataset (>100 APKs) in Docker can be slow. For that reason, we recommend that you visit our [docs](https://androidmalwarecrypto.readthedocs.io) where the full protocol of how to replicate our research is written.

## License

This project is licensed under the [MIT license](https://en.wikipedia.org/wiki/MIT_License).

## Project status & Contributing

We consider this project to be complete on the Android platform. Still, we plan to continue our exploration of cryptography in malware on other platforms. If you think of helping us with these efforts, you discovered a bug, or perhaps you want to enhance the functionality of `androidcrypto`, please do not hesitate to [open an issue](https://github.com/adamjanovsky/AndroidMalwareCrypto/issues) or [contact the authors](https://github.com/adamjanovsky/AndroidMalwareCrypto#authors).

## Authors

The study is a joint work of [Center for Research on Cryptography and Security](https://crocs.fi.muni.cz/) at [MUNI](https://www.muni.cz) and [University of Cagliari](https://www.unica.it/).

[Adam Janovsky](https://github.com/adamjanovsky), adamjanovsky@mail.muni.cz is a corresponding author.
