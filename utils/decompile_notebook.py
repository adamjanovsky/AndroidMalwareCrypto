import pickle
import lzma
from androguard.core.bytecodes.apk import APK
from androguard.core.bytecodes.dvm import DalvikVMFormat
from androguard.core.analysis.analysis import Analysis
from androguard.decompiler.decompiler import DecompilerJADX


def main():
    # a = APK('/Users/adam/Downloads/752E4B68C41AD27C74EF94E4F9D68061D5713EE1EA6AD14B44661522972C9D68.apk')
    # d = DalvikVMFormat(a)
    # dx = Analysis(d)
    # d.set_decompiler(DecompilerJADX(d, dx))
    #
    # if len(dx.classes) > 0:
    #     print('hurray')
    #
    # with lzma.open('/users/Adam/Downloads/test.lzma', 'wb') as handle:
    #     pickle.dump(dx, handle)

    with lzma.open('/users/Adam/Downloads/test.lzma', 'rb') as handle:
        sample = pickle.load(handle)
    classes = sample.get_classes()

    for cls in classes:
        src_class = cls.get_vm_class().get_source()
        if src_class is None:
            continue
        if cls.name != 'Lcom/blyts/parkourlite/utils/NotificationService$1;':
            continue
        for i, line in enumerate(src_class.split('\n')):
            print(line)
        #break


if __name__ == '__main__':
    main()
