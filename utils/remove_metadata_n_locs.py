import argparse
import pandas as pd

def main() -> None:

    parser = argparse.ArgumentParser(description="Remove `classes_loc` and replace with `metadata_n_classes` and `metadata_n_lines`")
    parser.add_argument(
        "input_json_path",
        metavar="INPUT_JSON_PATH", 
        type=str, 
        help="path to processed records in json"
    )
    parser.add_argument(
        "output_json_path",
        metavar="OUTPUT_JSON_PATH", 
        type=str, 
        help="path where to store output records"
    )
    args = parser.parse_args()
    df = pd.read_json(args.input_json_path, orient="index")
    df["metadata_n_classes"] = df["classes_loc"].apply(len)
    df["metadata_n_lines"] = df["classes_loc"].apply(lambda d: sum([len(l) for l in d.values()]))
    df.drop(columns=["classes_loc"], inplace=True)
    df.to_json(args.output_json_path, orient="index")

if __name__ == "__main__":
    main()