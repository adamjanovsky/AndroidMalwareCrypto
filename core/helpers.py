import os


def find_all_files_with_extension(dir_to_search, extension):
    all_files = [os.path.join(dp, f) for dp, dn, fn in os.walk(os.path.expanduser(dir_to_search)) for f in fn]

    return [f for f in all_files if f.endswith(extension)]


def get_apk_label(path):
    tokens = path.split('/')
    if len(tokens) > 2:
        return tokens[-2]
    else:
        return 'none'


def establish_results_filepath(dir_path, prefix, suffix):
    while True:
        candidate = os.path.join(dir_path, prefix + '.' + suffix)
        if not os.path.exists(candidate):
            break
        prefix += '+'
    return candidate
